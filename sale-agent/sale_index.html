<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sales Estimator â€” ChatGPT Agent</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Inter, system-ui, sans-serif; }
    .chat-bubble { max-width: 80%; padding: .75rem 1rem; border-radius: .75rem; margin-bottom: .5rem; white-space: pre-wrap; word-wrap: break-word; }
    .chat-bubble-user { background: #2563eb; color: #fff; align-self: flex-end; border-bottom-right-radius: .25rem; }
    .chat-bubble-assistant { background: #1f2937; color: #e5e7eb; align-self: flex-start; border-bottom-left-radius: .25rem; }
  </style>
</head>
<body class="bg-slate-900 text-slate-200 min-h-screen p-4 md:p-8">
  <div class="mx-auto max-w-6xl">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-white">Sales Estimator â€” Competitive POS Pricing</h1>
      <p class="text-slate-400 mt-2">Powered by ChatGPT Agent with OpenAI API. Upload your price book and chat right away.</p>
    </header>

    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 bg-slate-800 rounded-2xl p-6 shadow">
        <h2 class="text-xl font-semibold mb-4">1) Upload Price Book</h2>
        <div class="border-2 border-dashed border-slate-700 rounded-xl p-6 text-center">
          <label class="inline-flex items-center gap-2 px-5 py-3 rounded-xl bg-blue-600 hover:bg-blue-700 font-semibold cursor-pointer">
            Browse (.xlsx/.csv)
            <input id="file-input" type="file" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" class="hidden" />
          </label>
          <div id="file-info" class="mt-3 text-sm text-slate-400">No file selected.</div>
        </div>
        <div id="data-preview" class="mt-4 overflow-auto max-h-[400px] bg-slate-900 rounded-xl p-3 text-slate-400 text-sm">Preview will appear hereâ€¦</div>
      </div>

      <div class="bg-slate-800 rounded-2xl p-6 shadow flex flex-col">
        <h2 class="text-xl font-semibold mb-4">2) Chat with ChatGPT Agent</h2>
        <div id="chat-history" class="flex-1 overflow-y-auto bg-slate-900 rounded-xl p-4 flex flex-col text-sm"></div>
        <div class="mt-3 flex gap-2">
          <input id="free-text" class="flex-1 bg-slate-900 border border-slate-700 rounded-xl px-3 py-2" placeholder="Ask me about pricing, discounts, or quotesâ€¦"/>
          <button id="send-btn" class="px-4 py-2 rounded-xl bg-blue-600 hover:bg-blue-700 font-semibold">Send</button>
        </div>
      </div>
    </section>

    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
      <div class="lg:col-span-2 bg-slate-800 rounded-2xl p-6 shadow">
        <h2 class="text-xl font-semibold mb-4">3) Quote Result</h2>
        <div id="results" class="text-slate-400">Results will appear hereâ€¦</div>
      </div>
      <div class="bg-slate-800 rounded-2xl p-6 shadow flex flex-col">
        <h2 class="text-xl font-semibold mb-4">4) Deal Narrative</h2>
        <div id="narrative" class="flex-1 overflow-y-auto bg-slate-900 rounded-xl p-4 text-sm text-slate-300">Narrative will appear hereâ€¦</div>
        <div class="mt-3"><button id="export-btn" class="px-4 py-2 rounded-xl bg-slate-700 hover:bg-slate-600 font-semibold">Export CSV</button></div>
      </div>
    </section>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const UI = { file:$('#file-input'), fileInfo:$('#file-info'), preview:$('#data-preview'), chat:$('#chat-history'), freeText:$('#free-text'), send:$('#send-btn'), results:$('#results'), narrative:$('#narrative'), exportBtn:$('#export-btn') };

    function addMsg(text,who='assistant'){ const el=document.createElement('div'); el.className=`chat-bubble ${who==='user'?'chat-bubble-user':'chat-bubble-assistant'}`; el.textContent=text; UI.chat.appendChild(el); UI.chat.scrollTop=UI.chat.scrollHeight; }

    // decode API key from base64
    function decodeKey(b64){ try{ return atob(b64); }catch(e){ return ''; } }
    const OPENAI_KEY = decodeKey("c2stcHJvai1pUWtUQUxfMGh1MXFmU0k3N0gxRlF4STdCX2dUVnlMVERZREhRRllCTnlpdTl2em1ZOGc2YWhQc3JCVTcyYjl4NTBHOHNVOG14YlQzQmxia0ZKb25tM1RXaDlUVndjRHVoenpBclZsT1BMaUVGeDdBSXBjaUs2WmpqcDh4SUVDY2JZdmJObEY3b1BBbUF0YmktSkM3Q3hQd0NWd0E=");

    async function chatWithGPT(message){
      const res = await fetch("https://api.openai.com/v1/chat/completions",{
        method:"POST",
        headers:{"Content-Type":"application/json","Authorization":`Bearer ${OPENAI_KEY}`},
        body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a helpful sales assistant for POS pricing."},{role:"user",content:message}]})
      });
      const data = await res.json();
      return data.choices?.[0]?.message?.content || "(No response)";
    }

    UI.file.addEventListener('change',(e)=>{ const file=e.target.files[0]; if(!file) return; UI.fileInfo.textContent=`Loaded: ${file.name}`; addMsg('ðŸ“‚ Price Book uploaded. You can now chat with ChatGPT Agent about pricing.'); });

    UI.send.addEventListener('click',async()=>{ const text=UI.freeText.value.trim(); if(!text) return; addMsg(text,'user'); UI.freeText.value='';
      addMsg('ðŸ¤– Processing with ChatGPTâ€¦');
      const reply = await chatWithGPT(text);
      addMsg(reply,'assistant');
    });

    addMsg('ðŸ‘‹ Hello! Please upload a Price Book file to begin. After that, ask me anything about POS pricing and Iâ€™ll generate quotes for you.');
  </script>
</body>
</html>
